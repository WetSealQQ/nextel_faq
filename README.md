
## УСТАНОВКА МОДУЛЯ

- Заходим по ссылке (http://Ваш.домен/plugins)

- Если данного модуля нет в списке -> Обновляем список модулей
	![](/img/update_mods.png "update module")
	
- Устанавливаем модуль который появился после обновления 
	![](/img/install_mod.png "install module")
	
- Активируем модуль
	![](/img/activate_mod.png "active module")


## НАСТРОЙКА МОДУЛЯ

- В настройках модуля копируем URL для Вэбхуков
	![](/img/url_webhook.png "url webhook")
	
- Переходим по ссылке в личный кабинет nextel https://my.nextel.com.ua/index.html#api

- Добавляем по 1му событию: Новый звонок, Звонок перенаправлен, Ответ на звонок, Звонок завершен
	![](/img/add_event.png "add event")
	
- Вставляем в каждое поле события ссылку которую скопировали в CRM "URL для Вэбхуков" - 
- На этой же странице создаем ключ api nextel
	 ![](/img/create_key.png "create key")
* копируем его и вставляем в настройки модуля nextel в CRM


---


## ПОДКЛЮЧЕНИЕ ВХОДЯЩИХ И ИСХОДЯЩИХ ЗВОНКОВ В ЦРМ

- Для принятия и осуществления звонков пользователю в CRM нужно присвоить номер sip - 
	![](/img/operator_settings.png "operator_settings")
он должен соответствовать номеру установленным в софтфоне

- По этой ссылке можно получить данные пользователя sip телефона https://my.nextel.com.ua/index.html#users
( Настройка sip детально описана на сайте nextel https://nextel.com.ua/blog/knowledgebase )


#### Исходящие звонки

- для осуществления звонка переходим в карточку заказа
	![](/img/call_nextel.png "call_nextel")
выбираем nextel, далее если все настроено правильно в црм отобразиться всплывающее окошко и на Ваш софтфон будет осуществлен звонок - 
	![](/img/test_call.png "test_call")
после принятия вызова - начнется исходящий вызов на указанный в карточке номер
( ДЛЯ СОХРАНЕНИЯ ЗАПИСИ РАЗГОВОРА МОЖНО ЗВОНИТЬ ТОЛЬКО С УЖЕ СУЩЕСТВУЮЩЕЙ КАРТОЧКИ ЗАКАЗА )

- после окончания разговора запись прикрепляеться к данному заказу, сохранять заказ не обязательно
	![](/img/call_record.png "call_record")
( детальная настройка правил звонков настраивается в кабинете nextel https://my.nextel.com.ua/index.html#outscenarios )


#### Входящие звонки

- при входящем звонке в црм отобразиться всплывающее окошко, Ваш sip должен быть включен!
( детальная настройка правил звонков настраивается в кабинете nextel https://my.nextel.com.ua/index.html#inscenarios )

- когда ответите на звонок, Вы сможете сохранить данного клиента в црм, utm и номер телефона автоматически подставиться в новый заказ который нужно создавать ТОЛЬКО при нажатии на кнопку во всплывающем окне Сохранить заказ
* ![](/img/modal_in.png "modal_in")
 
* НЕ ЧЕРЕЗ ДОБАВИТЬ
* Данная функция сохранения работает только когда Вы находитесь в перечне заказов!



## АВТООБЗВОН
 - При успешной настройке модуля NEXTEL, в перечне заказов (1) у Вас появиться кнопка (2), которая открывает окно настроек автообзвона
* ![](/img/autodial.png "autodial")
* Основные настройки автообзвона создаются в кабинете nextel https://my.nextel.com.ua/index.html#autodial

- для манипуляции с номерами в автообзвоне - выделяем нужные заказы и открываем окно настроек автообзвона:
	![](/img/autodial_settings.png "autodial_settings")

- действия в поле "УПРАВЛЕНИЕ АВТООБЗВОНОМ" будут активны в зависимости от Статуса обзвона (на рис 3)
например: "Перезапуск обзвона" (на рис 8) будет доступен только для статуса "завершен"

- Пояснение по каждому пункту в окне настроек автообзвона:
	- № 1 на рис.  - при выборе автообзвона получаем статистику и состояние данного обзвона на рис (3, 4)
	- № 2 на рис.  - обновление данных для всех автообзвонов, если был добавлен новый автообзвон, в кабинете некстел, он добавиться в список выбора автообзвона
	- № 3 на рис.  - статус (текущее состояние) автообзвона, при действиях в поле "УПРАВЛЕНИЕ АВТООБЗВОНОМ" этот статус может изменяться
	- № 4 на рис.  - статистика.

	- № 5 на рис.  - в выбранных номерах будут отображаться номера с заказов которые выделели до открытия окна настроек автообзвона
	- № 6 на рис.  - действие добавления номеров в выбранный автообзвон ( по требованию nextel номера должны быть в международном формате ). Если будет ошибка хоть в 1м номере то не один номер не добавиться в автообзвон, в списке подсветяться невалидные номера
	- № 7 на рис.  - удаление номеров с автообзвона которые выделили. При удалении номеров все номера которые возможно удалить с данного автообзвона будут удалены, даже если в списке будет невалидный номер и будет ошибка
	- № 8 на рис.  - когда автообзвон завершен, его можно перезапустить, выбирая в списке статус номеров которые нужно обзвонить
	- № 9, 10 на рис.  - установка активного обзвона на паузу и снятие с нее соответственно
	- № 11 на рис.  - удаление всех номеров с обзвона, сброс статистики
	- № 12 на рис.  - завершение активного автообзвона


# UPD 29.10.2020




## ОБРАБОТКА ГОЛОСОВОГО МЕНЮ

В данный момент релизовано добавление заказа по активации голосового меню

- В настройках nextel ( https://my.nextel.com.ua/index.html#ivr ) в поле "Вебхук на url" добавляем ссылку с настроек в CRM "URL для вебхука голосового меню"
	![](/img/nextel_ivr.png "nextel_ivr")
	![](/img/nextel_ivr_crm.png "nextel_ivr_crm")

- Если нужно - можете добавить доп. поля которые попадут в CRM при активации указанной кнопки голосового меню ( рекомендуем указать Отдел, Товар - так как в заказ кроме номера телефона и сайта формата nextel.ivr/{{НАЖАТАЯ_АБОНЕНТОМ_КНОПКА}} , по умолчанию, ничего не будет добавлено )


## ДОБАВЛЕНИЕ НОМЕРОВ В АВТООБЗВОН ПО СОБЫТИЮ В CRM

При автообзвоне теперь можно открыть карточку заказа в всплывающем окне звонка в CRM
	![](/img/open_order_autodial.png "open_order_autodial")


Реализовано добавление номеров по событиям:

- "Изменение статуса заказа"

	![](/img/autodial_settings_crm.png "autodial_settings_crm")

	- № 1 на рис.  - Событие в CRM при котором номер тел. добавиться в указанный Вами автообзвон (в данном случае - Изменение статуса заказа)
	- № 2 на рис.  - При измении статуса заказа на любой из указанных в этом поле статус - номер с заказа добавиться в автообзвон. Поле обязательное для данного события.
	- № 3 на рис.  - Если предыдущий статус заказа будет соответствовать статусу с данного поля - номер не добавиться в автообзвон. Поле не обязательное.



- "Добавление заказа" (только для заказов добавленных по API)
	
	![](/img/autodial_settings_crm_addOrder.png "autodial_settings_crm_addOrder")

	- № 1 на рис.     - Событие в CRM при котором номер тел. добавиться в указанный Вами автообзвон (в данном случае - Добавление заказа)

	- № 2 на рис.     - Исключение. Если **включено** - номер с заказа **не добавиться** в автообзвон если в нем будут **ПРИСУТСТВОВАТЬ указанные данные** .Если **отключено** - номер с заказа **не добавиться** в автообзвон если в нем будут **ОТСУТСТВОВАТЬ указанные данные**. ( Например: в данном случае поле в заказе "Имя" должно быть со значением "bob" для добавления номера в автообзвон ) Поле не обязательное.

	- № 3, 4 на рис.  - Поле в CRM и соответсвующее ему значение по которым будет проверяться исключение .Поля не обязательные.